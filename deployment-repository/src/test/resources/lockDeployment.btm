RULE Create countDown for ContentRepositoryImpl
CLASS org.jboss.as.repository.ContentRepositoryImpl
METHOD addContent
AT ENTRY
IF TRUE
DO
  traceOpen("byteman", "/home/ehsavoie/tmp/byteman.log");
  traceln("byteman", "Creating countDown "  + $0);
  createCountDown($0, 1);
ENDRULE

RULE Test Lock deployment removal
CLASS org.jboss.as.repository.ContentRepositoryImpl
METHOD lock
AT EXIT
IF !countDown($0)
DO
  traceOpen("byteman", "/home/ehsavoie/tmp/byteman.log");
  traceStack("Invoking lock of ContentRepositoryImpl\n","byteman", 20);
  traceln("byteman", "I'm byteman and waiting for 3s " + $0);
  Thread.sleep(3 * 1000);
ENDRULE

RULE trace IOException create 
CLASS java.lang.Throwable
METHOD <init>
AT EXIT
DO
  traceOpen("byteman", "/home/ehsavoie/tmp/byteman.log");
  traceStack("IOException \n", "byteman", 20);
ENDRULE